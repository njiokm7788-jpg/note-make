{
  "project_structure": "React SPA with layered architecture: App.tsx orchestrates state and preview flow, imageProcessor.ts handles core processing logic returning preview data objects, ImagePreview.tsx renders individual preview panels. Data flows unidirectionally: App.tsx state -> generatePreview() -> preview object -> ImagePreview components. The preview system uses a 4-panel grid in comparison mode showing original, annotated, annotationLayer (mask preview), and result.",
  "relevant_files": [
    {
      "path": "src/utils/imageProcessor.ts",
      "relevance": 1.0,
      "rationale": "Core integration point: generatePreview() at line 427-471 returns preview object with 4 DataURLs. Must add new 'annotatedWithColorBlock' field to return type and generate it using applyColorBlock() on annotated image."
    },
    {
      "path": "src/App.tsx",
      "relevance": 0.95,
      "rationale": "State management hub: preview state at line 150-155 defines preview object structure. Must update type definition and pass new preview field to ImagePreview. Comparison view grid at lines 579-584 needs 5th panel."
    },
    {
      "path": "src/components/ImagePreview.tsx",
      "relevance": 0.7,
      "rationale": "Reusable preview component: no changes needed to component itself, but will be instantiated with new src prop for annotated+colorblock preview."
    },
    {
      "path": "src/components/ProcessingPanel.tsx",
      "relevance": 0.3,
      "rationale": "Controls processing options but does not directly handle preview display. May need awareness if preview layout changes significantly."
    }
  ],
  "patterns": "Preview generation pattern: generatePreview() loads images, processes them, returns object with DataURL strings for each preview type. Each preview type is generated by calling imageDataToDataURL() on processed ImageData. Existing previews: original (raw), annotated (scaled), annotationLayer (mask overlay on original), result (final composite). New preview should follow same pattern: process annotated image with color block overlay, convert to DataURL.",
  "dependencies": "Internal: imageProcessor.ts functions (loadImage, getImageData, scaleImageData, extractTextMask, applyColorBlock, imageDataToDataURL). External: Browser Canvas API for image manipulation. State: React useState for preview object in App.tsx, useDebounce for real-time preview updates.",
  "integration_points": "1. generatePreview() return type (src/utils/imageProcessor.ts:431-436): Add 'annotatedWithColorBlock: string' field to return object. 2. generatePreview() implementation (src/utils/imageProcessor.ts:457-463): Generate new preview by applying color block to annotated image (non-text areas get color overlay). 3. App.tsx preview state type (src/App.tsx:150-155): Update preview state interface to include new field. 4. App.tsx comparison view grid (src/App.tsx:579-584): Add 5th ImagePreview component for annotated+colorblock. 5. Grid layout consideration: Current 2x2 grid may need adjustment to 2x3 or 3x2 for 5 panels.",
  "constraints": "1. Performance: generatePreview() already processes images twice (mask extraction + color block application); adding another preview should reuse existing textMask and scaledAnnotatedData to avoid redundant computation. 2. Layout: Current comparison view uses 'grid-cols-2' (2x2 grid); adding 5th panel requires layout decision. 3. Backward compatibility: preview object structure change affects App.tsx state typing. 4. Memory: Each DataURL preview consumes memory; 5 previews instead of 4 increases memory footprint slightly.",
  "clarification_needs": [
    {
      "question": "Where should the new 'annotated with color block' preview be positioned in the comparison view grid?",
      "context": "Current comparison view shows 4 panels in 2x2 grid: original (top-left), annotated (top-right), annotationLayer/mask (bottom-left), result (bottom-right). Adding a 5th panel requires layout adjustment.",
      "options": [
        "Replace annotationLayer (mask preview) with annotated+colorblock, keeping 2x2 grid",
        "Add as 5th panel in 3x2 grid layout (3 columns, 2 rows with one empty)",
        "Add as 5th panel in 2x3 grid layout (2 columns, 3 rows with one empty)",
        "Show annotated+colorblock only in simplified view, not in comparison grid"
      ],
      "recommended": 0
    },
    {
      "question": "Should the annotated+colorblock preview show color blocks on ALL areas or only on non-text areas (matching final result behavior)?",
      "context": "The current processing logic applies color blocks only to non-text areas (text areas use original clear image). The new preview could either: show what the annotated image looks like with color overlay everywhere, or show color overlay only on non-text areas (same as result but without original image text).",
      "options": [
        "Apply color block to non-text areas only (consistent with result processing logic)",
        "Apply color block to entire annotated image (shows full color effect)"
      ],
      "recommended": 0
    }
  ],
  "_metadata": {
    "timestamp": "2026-02-01T12:00:00.000Z",
    "task_description": "在预览框添加标注图片添加色块后的预览 (Add preview of annotated image with color blocks in preview panel)",
    "source": "cli-explore-agent",
    "exploration_angle": "integration-points",
    "exploration_index": 2,
    "total_explorations": 3,
    "duration_seconds": 45
  }
}
