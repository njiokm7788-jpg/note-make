# UI 设计分析报告：反向遮罩叠加模式

## 1. 项目背景与现状分析

### 1.1 技术栈
- React 19 + TypeScript + Tailwind CSS
- 现有组件架构成熟，设计语言统一

### 1.2 现有组件分析

| 组件 | 功能 | 复用价值 |
|------|------|----------|
| `Sidebar.tsx` | 参数配置面板，支持折叠/展开 | **高** - 可直接扩展 |
| `ProcessingPanel.tsx` | 处理设置（备用） | 中 - 与 Sidebar 功能重叠 |
| `ImagePreview.tsx` | 图片预览 + 缩放查看 | **高** - 完全复用 |
| `UploadDrawer.tsx` | 底部抽屉式上传 | **高** - 复用上传逻辑 |

### 1.3 现有设计语言
- 圆角：`rounded-xl` / `rounded-2xl`
- 阴影：`shadow-sm`
- 边框：`border-slate-200`
- 主色：`primary-500` (蓝色系)
- 强调色：`purple-500` (高级设置区域)
- 成功色：`green-500` (下载按钮)

---

## 2. 参数配置界面设计

### 2.1 Sidebar 控件布局

基于现有 Sidebar 结构，新增反向遮罩模式所需控件：

```
┌─────────────────────────────────┐
│  处理设置              [实时预览] │
├─────────────────────────────────┤
│  快速预设                        │
│  [标准] [轻量] [强调] [自定义]    │
├─────────────────────────────────┤
│  ▼ 高级设置                      │
│  ┌─────────────────────────────┐│
│  │ 遮罩参数                     ││
│  │                             ││
│  │ 亮度阈值        [====●===] 200 │
│  │ 低于此值识别为文字            ││
│  │                             ││
│  │ 遮罩膨胀        [==●======] 3px │
│  │ 扩展遮罩覆盖范围              ││
│  │                             ││
│  │ ─────────────────────────── ││
│  │ 色块颜色        [■ #FF6B6B]  ││  ← 新增
│  │ 遮罩区域填充颜色              ││
│  │                             ││
│  │ ─────────────────────────── ││
│  │ ☑ 边缘引导膨胀               ││
│  │   边缘阈值      [===●====] 50 ││
│  └─────────────────────────────┘│
├─────────────────────────────────┤
│  [    预览处理效果    ]          │
│  [    下载结果        ]          │
└─────────────────────────────────┘
```

### 2.2 新增控件详细设计

#### 2.2.1 亮度阈值滑块（已有，保持）
```tsx
// 现有实现，无需修改
<input type="range" min="100" max="250" />
```
- 范围：100-250
- 默认值：200
- 说明文字：「亮度低于此值的像素被识别为文字，值越高识别的文字区域越多」

#### 2.2.2 遮罩膨胀滑块（已有，保持）
```tsx
// 现有实现，无需修改
<input type="range" min="0" max="10" />
```
- 范围：0-10px
- 默认值：3px
- 说明文字：「扩展文字遮罩区域，确保完全覆盖文字边缘」

#### 2.2.3 色块颜色选择器（新增）

**设计方案 A：预设色板 + 自定义**（推荐）

```
┌─────────────────────────────────┐
│ 色块颜色                         │
│ ┌───┬───┬───┬───┬───┬───┬───┐  │
│ │ ● │ ● │ ● │ ● │ ● │ ● │ + │  │  ← 预设颜色 + 自定义按钮
│ └───┴───┴───┴───┴───┴───┴───┘  │
│ 当前: ■ #FF6B6B                 │
└─────────────────────────────────┘
```

**预设颜色推荐**：
| 颜色 | HEX | 用途 |
|------|-----|------|
| 珊瑚红 | `#FF6B6B` | 默认，醒目但不刺眼 |
| 柔和橙 | `#FFA94D` | 温暖，适合笔记 |
| 薄荷绿 | `#69DB7C` | 清新，护眼 |
| 天空蓝 | `#74C0FC` | 冷静，专业 |
| 薰衣紫 | `#B197FC` | 优雅，文艺 |
| 暖黄 | `#FFE066` | 高亮，强调 |

**交互设计**：
1. 点击预设色块 → 立即应用
2. 点击「+」按钮 → 弹出原生颜色选择器
3. 当前颜色显示在下方，带色块预览

**组件实现建议**：
```tsx
interface ColorPickerProps {
  value: string;
  onChange: (color: string) => void;
  presets?: string[];
}

// 预设颜色
const defaultPresets = [
  '#FF6B6B', '#FFA94D', '#69DB7C',
  '#74C0FC', '#B197FC', '#FFE066'
];
```

**设计方案 B：简化版（仅预设）**

如果不需要完全自定义，可以只提供预设选项：
```
┌─────────────────────────────────┐
│ 色块颜色                         │
│ ○ 珊瑚红  ○ 柔和橙  ○ 薄荷绿    │
│ ○ 天空蓝  ○ 薰衣紫  ○ 暖黄      │
└─────────────────────────────────┘
```

**推荐方案 A**，因为：
- 满足个性化需求
- 预设覆盖常见场景
- 自定义作为补充

---

## 3. 预设方案设计

### 3.1 现有预设（保持）
| ID | 名称 | 阈值 | 膨胀 | 透明度 |
|----|------|------|------|--------|
| `standard` | 标准模式 | 200 | 3px | 70% |
| `light` | 轻量标注 | 200 | 2px | 40% |
| `emphasis` | 强调标注 | 180 | 4px | 90% |

### 3.2 新增预设建议（针对反向遮罩模式）

| ID | 名称 | 阈值 | 膨胀 | 色块颜色 | 适用场景 |
|----|------|------|------|----------|----------|
| `mask-standard` | 标准遮罩 | 200 | 3px | `#FF6B6B` | 通用场景 |
| `mask-precise` | 精确遮罩 | 180 | 2px | `#74C0FC` | 细小文字 |
| `mask-wide` | 宽松遮罩 | 220 | 5px | `#69DB7C` | 粗体文字 |
| `mask-highlight` | 高亮遮罩 | 200 | 3px | `#FFE066` | 强调标注 |

### 3.3 预设切换 UI

```
┌─────────────────────────────────┐
│ 快速预设                         │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐│
│ │标准 │ │精确 │ │宽松 │ │高亮 ││
│ │遮罩 │ │遮罩 │ │遮罩 │ │遮罩 ││
│ │ ■   │ │ ■   │ │ ■   │ │ ■   ││  ← 色块预览
│ └─────┘ └─────┘ └─────┘ └─────┘│
└─────────────────────────────────┘
```

每个预设按钮下方显示对应的色块颜色预览，帮助用户快速识别。

---

## 4. 预览体验设计

### 4.1 预览区域布局

**方案 A：三栏对比（推荐）**

```
┌─────────────────────────────────────────────────────┐
│                    预览区域                          │
├─────────────┬─────────────┬─────────────────────────┤
│   清晰图    │   模糊图    │       处理结果          │
│  (原图)     │  (标注图)   │                         │
│             │             │                         │
│   [缩略图]  │   [缩略图]  │      [大图预览]         │
│             │             │                         │
└─────────────┴─────────────┴─────────────────────────┘
```

- 左侧两栏：输入图片缩略图
- 右侧大栏：处理结果大图
- 点击任意图片可放大查看

**方案 B：标签页切换**

```
┌─────────────────────────────────────────────────────┐
│  [清晰图] [模糊图] [遮罩预览] [处理结果]            │
├─────────────────────────────────────────────────────┤
│                                                     │
│                   当前选中的图片                     │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**推荐方案 A**，因为：
- 一目了然，无需切换
- 便于对比效果
- 符合图片处理工具的常见模式

### 4.2 遮罩预览功能

新增「遮罩预览」视图，帮助用户理解遮罩效果：

```
┌─────────────────────────────────┐
│         遮罩预览                │
│  ┌───────────────────────────┐ │
│  │                           │ │
│  │   原图 + 半透明色块叠加    │ │
│  │   (文字区域显示色块颜色)   │ │
│  │                           │ │
│  └───────────────────────────┘ │
│  ☑ 显示遮罩边界               │
└─────────────────────────────────┘
```

**实现建议**：
- 复用现有 `generateMaskPreview` 函数
- 将固定的红色改为用户选择的色块颜色
- 可选：添加遮罩边界轮廓线

### 4.3 实时预览优化

现有实时预览功能已经很完善，建议保持：
- 开关控制：`实时预览` Toggle
- 处理中状态：显示 loading spinner
- 防抖处理：避免频繁触发

---

## 5. 用户引导设计

### 5.1 术语统一

**问题**：「原图」「标注图」「清晰图」「模糊图」容易混淆

**解决方案**：统一使用更直观的术语

| 技术术语 | 用户友好术语 | 说明 |
|----------|--------------|------|
| 原图 | **清晰图** | 不含任何标注的干净原图 |
| 标注图 | **模糊图** | 包含 AI 标注/遮罩的图片 |

### 5.2 上传区域引导

**UploadDrawer 改进建议**：

```
┌─────────────────────────────────────────────────────┐
│                    上传图片                          │
├─────────────────────────────────────────────────────┤
│  ┌─────────────────┐    ┌─────────────────┐        │
│  │                 │    │                 │        │
│  │   📷 清晰图     │    │   🎨 模糊图     │        │
│  │                 │    │                 │        │
│  │  不含任何标注   │    │  包含 AI 标注   │        │
│  │  的干净原图     │    │  或遮罩的图片   │        │
│  │                 │    │                 │        │
│  └─────────────────┘    └─────────────────┘        │
│                                                     │
│  💡 小提示：                                        │
│  • 清晰图 = 原始截图/照片                           │
│  • 模糊图 = AI 处理后带有色块遮罩的图片             │
│  • 两张图片尺寸应相同或相近                         │
└─────────────────────────────────────────────────────┘
```

### 5.3 首次使用引导

**新用户引导流程**：

```
Step 1: 欢迎页
┌─────────────────────────────────┐
│  🖼️ 图片遮罩处理工具            │
│                                 │
│  将 AI 标注的模糊区域           │
│  替换为清晰原图内容             │
│                                 │
│  [开始使用]                     │
└─────────────────────────────────┘

Step 2: 上传引导
┌─────────────────────────────────┐
│  第 1 步：上传清晰图            │
│  ────────────────────           │
│  这是不含任何标注的原始图片     │
│                                 │
│  [选择文件] 或 拖拽到此处       │
└─────────────────────────────────┘

Step 3: 参数说明
┌─────────────────────────────────┐
│  第 3 步：调整参数              │
│  ────────────────────           │
│  • 亮度阈值：控制文字识别范围   │
│  • 遮罩膨胀：扩展遮罩边界       │
│  • 色块颜色：遮罩区域的颜色     │
│                                 │
│  [使用默认设置] [自定义]        │
└─────────────────────────────────┘
```

### 5.4 工具提示 (Tooltip)

为每个参数添加悬停提示：

```tsx
// 亮度阈值
<Tooltip content="亮度值 0-255，低于此值的像素被识别为文字。值越高，识别的文字区域越多。">
  <label>亮度阈值</label>
</Tooltip>

// 遮罩膨胀
<Tooltip content="向外扩展遮罩边界，确保完全覆盖文字边缘。单位：像素。">
  <label>遮罩膨胀</label>
</Tooltip>

// 色块颜色
<Tooltip content="遮罩区域的填充颜色。选择与原图背景相近的颜色效果更自然。">
  <label>色块颜色</label>
</Tooltip>
```

---

## 6. 响应式设计

### 6.1 断点定义

| 断点 | 宽度 | 布局 |
|------|------|------|
| Mobile | < 640px | 单栏，底部抽屉 |
| Tablet | 640px - 1024px | 侧边栏浮层 |
| Desktop | > 1024px | 侧边栏固定 |

### 6.2 移动端适配

**布局调整**：

```
Mobile (< 640px)
┌─────────────────────┐
│      顶部导航       │
├─────────────────────┤
│                     │
│     预览区域        │
│   (单图 + 切换)     │
│                     │
├─────────────────────┤
│  [上传] [设置] [下载]│  ← 底部操作栏
└─────────────────────┘
```

**交互调整**：
1. 预览区域：单图显示 + 左右滑动切换
2. 参数设置：底部抽屉弹出
3. 上传：全屏模态框

**色块颜色选择器移动端**：
```
┌─────────────────────┐
│ 色块颜色            │
│ ┌───┬───┬───┐      │
│ │ ● │ ● │ ● │      │  ← 3x2 网格
│ ├───┼───┼───┤      │
│ │ ● │ ● │ + │      │
│ └───┴───┴───┘      │
└─────────────────────┘
```

### 6.3 平板适配

**布局调整**：

```
Tablet (640px - 1024px)
┌─────────────────────────────────┐
│           顶部导航              │
├─────────────────────────────────┤
│  ┌─────┐                        │
│  │设置 │      预览区域          │
│  │面板 │    (两栏对比)          │
│  │浮层 │                        │
│  └─────┘                        │
└─────────────────────────────────┘
```

- 侧边栏：浮层模式（现有 `overlayMode` 已支持）
- 预览：两栏布局（输入 + 结果）

### 6.4 触摸优化

| 元素 | 最小尺寸 | 间距 |
|------|----------|------|
| 按钮 | 44x44px | 8px |
| 滑块 | 高度 32px | - |
| 色块 | 40x40px | 8px |

---

## 7. 实现优先级

### 7.1 Phase 1：核心功能（必须）
1. ✅ 亮度阈值滑块（已有）
2. ✅ 遮罩膨胀滑块（已有）
3. 🆕 色块颜色选择器（预设 + 自定义）
4. 🆕 更新 `ProcessingOptions` 类型

### 7.2 Phase 2：体验优化（建议）
1. 🆕 遮罩预览视图
2. 🆕 新增预设方案
3. 🆕 术语统一（清晰图/模糊图）
4. 🆕 工具提示

### 7.3 Phase 3：响应式（可选）
1. 🆕 移动端布局优化
2. 🆕 触摸交互优化
3. 🆕 首次使用引导

---

## 8. 技术实现建议

### 8.1 ProcessingOptions 类型扩展

```typescript
export interface ProcessingOptions {
  // 现有字段
  annotationOpacity: number;
  textThreshold: number;
  maskExpand: number;
  useEdgeGuidedExpand: boolean;
  edgeThreshold: number;

  // 新增字段
  maskColor: string;  // 色块颜色，如 '#FF6B6B'
}
```

### 8.2 ColorPicker 组件

```tsx
// src/components/ColorPicker.tsx
interface ColorPickerProps {
  value: string;
  onChange: (color: string) => void;
  presets?: string[];
  label?: string;
  description?: string;
}

export function ColorPicker({
  value,
  onChange,
  presets = ['#FF6B6B', '#FFA94D', '#69DB7C', '#74C0FC', '#B197FC', '#FFE066'],
  label = '色块颜色',
  description = '遮罩区域填充颜色'
}: ColorPickerProps) {
  // 实现...
}
```

### 8.3 Sidebar 集成

在 Sidebar 的高级设置区域添加 ColorPicker：

```tsx
// 在 "边缘引导膨胀" 之前添加
<div className="space-y-2">
  <ColorPicker
    value={options.maskColor}
    onChange={(color) => handleOptionChange({ ...options, maskColor: color })}
  />
</div>
```

---

## 9. 总结

### 9.1 设计原则
1. **一致性**：复用现有设计语言和组件
2. **渐进式**：从核心功能开始，逐步优化
3. **可访问性**：清晰的标签、足够的对比度
4. **响应式**：适配多种设备

### 9.2 关键决策
| 决策点 | 选择 | 理由 |
|--------|------|------|
| 颜色选择器 | 预设 + 自定义 | 平衡易用性和灵活性 |
| 预览布局 | 三栏对比 | 直观对比效果 |
| 术语 | 清晰图/模糊图 | 更易理解 |
| 移动端 | 底部抽屉 | 符合移动端习惯 |

### 9.3 下一步行动
1. 确认色块颜色选择器方案
2. 扩展 `ProcessingOptions` 类型
3. 实现 `ColorPicker` 组件
4. 集成到 `Sidebar.tsx`
5. 更新预设方案
